<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Movements between city tiles Data analysis by Sebastian Andreasen and Oliver Brandt. Pick a city - either Nairobi or Mombasa in Kenya or Lagos or Abuja in Nigeria to the right →
.vis { margin: 0 auto; height: 370px; } .line-baseline { stroke: black; stroke-width: 1.5; fill: none; stroke-dasharray: 10 5; opacity: 0.2; } .line-horizontal { stroke: #bdc3c7; stroke-width: 1; fill: none; stroke-dasharray: 10 5; } .line-crisis { fill: none; stroke: black; stroke-width: 2; stroke-opacity: 0."><meta property="og:title" content="" />
<meta property="og:description" content="Movements between city tiles Data analysis by Sebastian Andreasen and Oliver Brandt. Pick a city - either Nairobi or Mombasa in Kenya or Lagos or Abuja in Nigeria to the right →
.vis { margin: 0 auto; height: 370px; } .line-baseline { stroke: black; stroke-width: 1.5; fill: none; stroke-dasharray: 10 5; opacity: 0.2; } .line-horizontal { stroke: #bdc3c7; stroke-width: 1; fill: none; stroke-dasharray: 10 5; } .line-crisis { fill: none; stroke: black; stroke-width: 2; stroke-opacity: 0." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://covid19.compute.dtu.dk/visualizations/movement_adm_tile/" />
<meta property="article:modified_time" content="2020-07-01T18:53:23+07:00" />
<title>Movement Adm Tile | COVID-19 mobility</title>
<link rel="icon" href="/favicon.png" type="image/x-icon">


<link rel="stylesheet" href="/book.min.8b34b0846c7c6544613b2301559d146e1ddebf7ee7068ccc53d2fd0e9b3701b9.css" integrity="sha256-izSwhGx8ZURhOyMBVZ0Ubh3ev37nBozMU9L9Dps3Abk=">


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-167958784-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->

  
</head>

<body>
  <input type="checkbox" class="hidden" id="menu-control" />
  <main class="container flex">
    <aside class="book-menu">
      
  <nav>
<h2 class="book-brand">
  <a href="/"><img src="/dtu.png" alt="Logo" /><span>COVID-19 mobility</span>
  </a>
</h2>












  <ul>
<li>
<p><strong><a href="/">Main Page</a></strong></p>
</li>
<li>
<p><strong>Posts</strong></p>
<ul>
<li>
<p><strong>Kenya</strong>
<a href="/posts/timeline_kenya/">Timeline</a></p>
<ul>
<li><a href="/posts/data_quality_kenya/"><em>Kenya</em>: <br>
Data quality</a></li>
<li><a href="/posts/kenya_where_are_people/"><em>Kenya</em>: <br>
Where are people?</a></li>
<li><a href="/posts/kenya_how_people_move/"><em>Kenya</em>: <br>
How people move</a></li>
</ul>
</li>
<li>
<p><strong>Nigeria</strong>
<a href="/posts/timeline_nigeria/">Timeline</a></p>
<ul>
<li><a href="/posts/data_quality_nigeria/"><em>Nigeria</em>: <br>
Data quality</a></li>
<li><a href="/posts/nigeria_where_are_people/"><em>Nigeria</em>: <br>
Where are people?</a></li>
<li><a href="/posts/nigeria_how_people_move/"><em>Nigeria</em>: <br>
How people move</a></li>
</ul>
</li>
</ul>
<!-- raw HTML omitted -->
</li>
<li>
<p><strong>Visualizations</strong></p>
<ul>
<li><em>Where people are</em>
<!-- raw HTML omitted -->
<ul>
<li><a href="/visualizations/where_people_are_going_out/">Going out</a></li>
<li><a href="/visualizations/where_people_are_change_in_population_size/">Change in population size</a></li>
<li><a href="/visualizations/where_people_are_population_concentration/">Population distribution</a></li>
</ul>
</li>
<li><em>How people move</em>
<ul>
<li><a href="/visualizations/movement_adm_tile/"class=active><strong>New</strong> Particle city movement</a></li>
<li><a href="/visualizations/how_people_move_movements_between_tiles/"><strong>New</strong> Tile city movement</a></li>
</ul>
<!-- raw HTML omitted -->
<ul>
<li><a href="/visualizations/how_people_move_staying_home/">Staying home</a></li>
<li><a href="/visualizations/how_people_move_movements_between_municipalities/">Movements between municipalities</a></li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>Data</strong></p>
<ul>
<li><a href="/data/population_density_maps/">Population Density Maps</a></li>
<li><a href="/data/movement_maps/">Movement Maps</a>
<!-- raw HTML omitted --></li>
</ul>
</li>
</ul>










</nav>




  <script>(function(){var menu=document.querySelector("aside.book-menu nav");addEventListener("beforeunload",function(event){localStorage.setItem("menu.scrollTop",menu.scrollTop);});menu.scrollTop=localStorage.getItem("menu.scrollTop");})();</script>


 
    </aside>

    <div class="book-page">
      <header class="book-header">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <strong>Movement Adm Tile</strong>

  <label for="toc-control">
    
  </label>
</div>


  
 
      </header>

      
      
  <article class="markdown"><h1 id="movements-between-city-tiles"><strong>Movements between city tiles</strong></h1>
<span style="font-size:14px"><em>Data analysis by <a href="mailto:sstan@dtu.dk">Sebastian Andreasen</a> and <a href="mailto:ob95@me.com">Oliver Brandt</a>.</em></span>
<p><strong>Pick a city - either Nairobi or Mombasa in Kenya or Lagos or Abuja in Nigeria to the right →</strong></p>




<style type="text/css">
	.vis {
		margin: 0 auto;
		height: 370px;
	}

	.line-baseline {
		stroke: black;
		stroke-width: 1.5;
		fill: none;
		stroke-dasharray: 10 5;
		opacity: 0.2;
	}

	.line-horizontal {
		stroke: #bdc3c7;
		stroke-width: 1;
		fill: none;
		stroke-dasharray: 10 5;
	}

	.line-crisis {
		fill: none;
		stroke: black;
		stroke-width: 2;
		stroke-opacity: 0.25;
	}

	.line-changeall {
		fill: none;
		stroke: black;
		stroke-width: 1;
		stroke-opacity: 0.7;
	}

	.line-tooltip {
		stroke: 'black';
		stroke-dasharray: 5 2.5;
		stroke-width: 1.5;
	}

	.line {
		fill: none;
		stroke: black;
		stroke-width: 2;
		stroke-opacity: 0.25;
	}

	.rect-tooltip {
		fill: white;
		fill-opacity: 0;
		z-index: 1;
	}

	.trendline {
		fill: none;
		stroke: red;
		stroke-width: 2.5;
	}

	.histEvent {
		stroke: grey;
		stroke-width: 2;
		stroke-opacity: 1;
	}

	.histEventDot {
		fill: grey;
	}

	.map-polygon-movements {
		stroke: white;
		stroke-width: 0.3;
	}

	.map-polygon-movements-circumference {
		stroke: black;
		stroke-width: 1;
	}

	.dot-baseline {
		fill: white;
		stroke: #2c3e50;
		stroke-width: 2;
		opacity: 0;
	}

	.dot {
		fill: black;
		opacity: 0.5;
	}

	.legend-label {
		text-anchor: start;
		font-weight: 300;
		cursor: pointer;
	}

	.right-legend {
		font-size: 12px;
	}

	.tooltip {
		position: absolute;
		top: 0;
		line-height: 1;
		font-weight: 500;
		padding: 12px;
		background: rgba(0, 0, 0, 0.8);
		color: #fff;
		border-radius: 2px;
	}

	.toggle {
		-webkit-user-select: none;
		 
		-moz-user-select: none;
		 
		-ms-user-select: none;
		 
		user-select: none;
		 
	}

	.select-place {
		position: absolute;
		right: 0px;
	}

	.flex {
		display: flex;
	}

	.flex-col {
		flex-direction: column;
	}

	.radio-rect {
		cursor: pointer;
		fill: #636e72;
	}

	.radio-rect.selected {
		fill: #0984e3;
	}

	.radio-text {
		text-anchor: middle;
		stroke: none;
		fill: white;
		font-weight: 600;
		cursor: pointer;
	}

	.radio-text.selected {
		text-anchor: middle;
		stroke: none;
		fill: white;
		font-weight: 600;
	}

	@keyframes spinner-line-fade-quick {

		0%,
		39%,
		100% {
			opacity: 0.25;
			 
		}

		40% {
			opacity: 1;
		}
	}
</style>






<div style="max-height: 0px">
	<svg>
		<defs>
			<pattern id="lines" height="10" width="10" patternUnits="userSpaceOnUse" patternTransform="rotate(-45)">
				<line x1="0" y1="4" x2="10" y2="4" stroke-width="2" stroke="black" />
			</pattern>
			<pattern id="thinlines" height="5" width="5" patternUnits="userSpaceOnUse" patternTransform="rotate(-45)">
				<line x1="0" y1="2" x2="10" y2="2" stroke-width="0.5" stroke="black" />
			</pattern>
		</defs>
	</svg>
</div>







<script src="/dist/d3.v5.min.js"></script>
<script src="/dist/d3-simple-slider.min.js"></script>
<script src="/dist/chroma.min.js"></script>
<script src="/dist/spin.min.js"></script>


<script src="/scripts/eventDates.js"></script>
<script src="/scripts/timeSeriesFigure.js"></script>
<script src="/scripts/choroplethMap.js"></script>
<script src="/scripts/choroplethMap_tile.js"></script>

<script>

	
	

	
	let spinnerOpts = {
		lines: 8, 
		length: 0, 
		width: 8, 
		radius: 18, 
		corners: 10, 
		color: '#313131', 
		fadeColor: 'transparent', 
		speed: 1, 
		rotate: 0, 
		animation: 'spinner-line-fade-quick', 
	};

	
	function adjustBaseline(datum) {
		datumy = d3.range(7).map(() => []);
		datum.forEach((d, i) => {
			datumy[i % 7].push(d[1]);
		});
		datumy = datumy.map(d => d3.mean(d));
		return datum.map((d, i) => [d[0], datumy[i % 7]]);
	}

	
	function zip(a, b) {
		return a.map((e, i) => [e, b[i]]);
	}

	function round(val, order) {
		return Math.round(val * order) / order;
	}

	Date.prototype.addDays = function (n) {
		let date = new Date(this.valueOf());
		date.setDate(date.getDate() + n);
		return date;
	}

	function weekavg(y) {
		let y_avg = [];
		y.forEach((v, i) => {
			let i0 = Math.max(0, i - 3);
			let i1 = Math.min(y.length - 1, i + 4);
			y_avg.push(d3.mean(y.slice(i0, i1)));
		});
		return y_avg;
	}

	function insertKSeperators(x) {
		return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".");
	}

	
	if (sessionStorage.country == undefined) { sessionStorage.country = "Kenya"; }
	function createWorld() {
		var countries = []
		d3.json("/data/countries.json").then(function (data) {
			countries = data.sort();
			body = document.getElementsByClassName('container flex')[0];
			toc = document.createElement('aside');
			toc.className = "book-toc";
			nav = document.createElement('nav');
			nav.id = "countries";
			ul = document.createElement('ul');
			countries.forEach(function (item, index) {
				li = document.createElement('li');
				a = document.createElement('a');
				a.text = item;
				a.style.cursor = "pointer";
				if (item != sessionStorage.country) {
					a.onclick = function () {
						sessionStorage.country = item;
						window.location.reload();
					};
				} else {
					a.style.color = "red";
				}
				li.appendChild(a);
				ul.appendChild(li);
			});
			nav.appendChild(ul);
			toc.appendChild(nav);
			body.appendChild(toc);
		})
	}
	createWorld();
</script>
<p>The movement data can provide us with insights on how people are moving between different locations. In this case due to limited data, it has been decided to focus only on the larger cities in Kenya and Nigeria. The movements between tiles are shown for each time-slot.</p>
<p>The map shows the outline of the selected city, while the edges represent movements between tiles within the city. The larger the size of the edges and particles is, the more people move between the tiles.</p>
<ul>
<li>
<p>The <strong><span style="color:#c0392b">red</span></strong> edges means that there is less movement than the baseline.</p>
</li>
<li>
<p>The <strong><span style="color:#1E90FF">blue</span></strong> edges means that there is more movement than the baseline.</p>
</li>
</ul>


<!DOCTYPE html>
<meta charset="utf-8">


<div class="flex">
	<div id="slider-time">
		<h3 id="country"></h3>
		<p id="value-time"></p>

	</div>
	<div class="radio-timeframe" id='radio-movementsTileFig'></div>
</div>
<div class="flex flex-col">
	<div id='vis-movementsTileFig' style="height: 600;">
		<canvas id='vis-movementsTileCanvas' />

	</div>
</div>







<script>
	let spinnermovements = new Spinner(spinnerOpts).spin(document.getElementById('vis-movementsFig'));

	d3.json("/data/" + sessionStorage.country + ".geojson").then(function (stateShape) {
		d3.csv("/data/" + sessionStorage.country + ".csv").then(function (nairobi_move_tiles) {
			spinnermovements.stop();
			


			d3.select('h3#country').text((sessionStorage.country).replace('_', ' '))

			function clearData() {
				
				
				svg.selectAll('path.route').remove()
			}
			var _N = []
			nairobi_move_tiles.map(function (d) {
				_N.push(d.time_index);
			})

			
			let N = [...new Set(_N)].length
			d3.select('p#value-time').text("2020-03-23 0000")
			var sliderTime = d3
				.sliderBottom()
				.min(0)
				.max(N - 1)
				.step(1)
				.width(450)
				
				
				.tickFormat(idxToDate)
				
				.on('onchange', val => {
					clearData()

					flowsGeoJson = generateLinksGeoJson(showTopNumberOfPaths, TimeFiltered(val, nairobi_move_tiles))
					renderPaths(flowsGeoJson)
					drawParticles()

					d3.select('p#value-time').text(TimeFiltered(val, nairobi_move_tiles)[0].date_time);
				});

			

			let gTime = d3
				.select('#slider-time')
				.append('svg')
				.attr('width', 500)
				.attr('height', 100)
				.append('g')
				.attr('transform', 'translate(30,30)');

			gTime.call(sliderTime);

			

			function TimeFiltered(indexCounter, city_data) {
				let newData = city_data.filter(function (element) {
					if (Number(element["time_index"] == indexCounter)) {
						return Number(element["time_index"])
					}

				});
				return newData

			}
			
			function idxToDate(i) {
				let days = ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'];
				
				let date = new Date(2020, 3, 6);
				date.setHours(date.getHours() + 8 * (i - 1));
				let dateString = "";
				dateString += days[date.getDay()] + " ";
				dateString += date.getDate() + "/";
				dateString += date.getMonth() + 1
				return dateString
			}

			


			uniqueId = 'movementsTileFig';
			let country_dims = { 'Nigeria_Abuja': 850, 'Nigeria_Lagos': 200, 'Kenya_Nairobi': 520, 'Kenya_Mombasa': 920 }
			
			let figureWidth = 770,
				figureHeight = country_dims[sessionStorage.country];

			const canvas = document.getElementById("vis-movementsTileCanvas")
			const maindiv = document.getElementById("vis-movementsTileFig")

			maindiv.style.position = 'relative'
			maindiv.style.width = figureWidth;
			maindiv.style.height = figureHeight;
			maindiv.style.top = '0px';


			canvas.height = figureHeight;
			canvas.width = figureWidth;
			canvas.style.position = 'absolute'
			
			canvas.style.zIndex = '1'
			canvas.style.bottom = '0px'
			canvas.style.left = '0px'
			canvas.style.right = '0px'
			
			

			const context = canvas.getContext("2d")

			width = figureWidth;
			height = figureHeight;
			
			

			svg = d3.select("#vis-" + uniqueId)
				.append("svg")
				.attr("width", width)
				.attr("height", height);

			g = svg.append("g");

			projection = d3.geoIdentity()
				.reflectY(true)
				.fitWidth(width, stateShape);

			path = d3.geoPath(projection);

			function renderStates(stateShape) {
				
				const g = svg.append('g').attr("start_quadkey", "states")
				g.selectAll("path").data(stateShape.features)
					.enter()
					.append("path")
					.attr("d", path)
					.attr("start_quadkey", function (d) { return "quad_" + d.start_quadkey }) 
					.style("fill", "#fff")
					.attr("stroke", "#000")
					.attr("stroke-width", 0.9);
			}
			
			function renderPaths(flow_data) {
				svg.select('#routes').remove()
				const g = svg.append('g').attr("start_quadkey", "routes")
				g.selectAll("path").data(flow_data)
					.enter()
					.append("path")
					.attr("d", d => path(d))
					
					.attr("stroke", function (d) { if (d.percent_change > 0) { return "blue" } else { return "red" } })
					.attr("fill", 'none')
					.attr("stroke-opacity", function (d) { return 0.1 * d.value / maxValueParticle + 0.1 })
					.attr("stroke-width", function (d) { return 100 * d.value / maxValueParticle + 0.5 })
					.attr("value", function (d) { return d.value })
					.attr("class", "route");

			}
			const maxValueParticle = 10000
			const showTopNumberOfPaths = 300
			


			function drawParticles() {
				
				const t = d3.timer(tick, 2000); 
				var particles = []
				var freqCounter = 0
				function tick(elapsed) {

					
					particles = particles.filter(function (d) { return d.current < d.path.getTotalLength() })
					if (freqCounter > 10000) { 
						freqCounter = 1;
					}
					if (freqCounter % 600 == 0) { 
						d3.selectAll("path.route")
							.each(
								function (d) {
									var offset = (Math.random() - .5) * 10; 

									particles.push({ link: d, time: elapsed, offset: offset, path: this, speed: 0.15 })
								}
							);
					}
					drawParticlesOnCanvas(elapsed, context, null, particles);
					freqCounter++;

				}
			}

			function generateLinksGeoJson(showTopNumberOfPaths, data_nairobi) {
				const data = data_nairobi.sort((a, b) => (a.value < b.value) ? 1 : -1)
				const links = [];
				for (let i = 0; i < showTopNumberOfPaths; i++) {
					if (data[i] && data[i].end_lon && data[i].start_lon) {
						links.push({
							type: "LineString",
							coordinates: [
								[data[i].start_lon - 0.045, data[i].start_lat - 0.01],
								[data[i].end_lon - 0.045, data[i].end_lat - 0.01],
							],
							value: parseInt(data[i].n_crisis), 
							percent_change: parseInt(data[i].percent_change),
						});
					}
				}
				return links;
			}
			function drawParticlesOnCanvas(elapsed, cx, particlesColorScale, particles) {
				cx.clearRect(0, 0, 2 * width, 2 * height);
				var x;

				for (x = 0; x < particles.length; x++) {
					var currentTime = elapsed - particles[x].time;
					particles[x].current = .2 * particles[x].speed * currentTime / 1000 * 400; 
					var currentPos = particles[x].path.getPointAtLength(particles[x].current)
					cx.beginPath();

					cx.fillStyle = particles[x].path.getAttribute("stroke");
					cx.lineWidth = "3px";

					cx.arc(
						currentPos.x,
						currentPos.y + particles[x].offset,
						Math.sqrt(1.5 * particles[x].path.getAttribute("stroke-width")),
						0,
						5 * Math.PI
					);
					cx.stroke();
					cx.fill();
				}
			}

			renderStates(stateShape)

			flowsGeoJson = generateLinksGeoJson(10000, TimeFiltered(1, nairobi_move_tiles))
			renderPaths(flowsGeoJson)
			drawParticles()
			
			
		})
	})

</script>


<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
</article>
 
      

      <footer class="book-footer">
        
  <div class="flex justify-between">





</div>

 
        
      </footer>

      
  
  <div class="book-comments">

</div>
  
 

      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    
  </main>

  
</body>

</html>












